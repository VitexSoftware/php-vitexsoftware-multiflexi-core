{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "2.1.0",
  "title": "MultiFlexi App Definition",
  "type": "object",
  "properties": {
    "image": { "type": "string" },
    "name": {
      "type": "string",
      "description": "The name of the application.",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "A brief description of the application.",
      "optional": true
    },
    "executable": { "type": "string" },
    "setup": {
      "type": "string",
      "description": "Optional setup command or script to be executed when the configuration is applied.",
      "default": "",
      "optional": true
    },
    "cmdparams": { "type": "string" },
    "deploy": { "type": "string" },
    "package": {
      "type": "string",
      "description": "Optional name of the installation package.",
      "optional": true
    },
    "homepage": {
      "type": "string",
      "description": "URL of the application's homepage."
    },
    "ociimage": {
      "type": "string",
      "description": "OCI image reference for the application.",
      "default": "",
      "examples": ["docker.io/library/nginx:latest"],
      "optional": true
    },
    "uuid": {
      "type": "string",
      "description": "Universally unique identifier for the application."
    },
    "topics": {
      "type": "array",
      "items": { "type": "string" },
      "description": "List of topics related to the application."
    },
    "requirements": {
      "type": "array",
      "items": { "type": "string" },
      "description": "List of requirements needed by the application."
    },
    "version": {
      "type": "string",
      "description": "The version of the application.",
      "minLength": 1
    },
    "multiflexi": {
      "type": "string",
      "description": "Minimal required MultiFlexi version for running this application.",
      "minLength": 1,
      "optional": true
    },
    "artifacts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string", "description": "Name of the artifact." },
          "path": { "type": "string", "description": "Path to the artifact file." },
          "type": { "type": "string", "description": "Type of the artifact (e.g., file, directory)." },
          "description": { "type": "string", "description": "Description of the artifact." }
        },
        "required": ["name", "path", "type", "description"],
        "additionalProperties": false
      }
    },
    "produces": {
      "type": "object",
      "description": "Artifacts or data entities created by the application",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "object",
          "properties": {
            "description": { "type": "string" },
            "patterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Glob patterns or MIME types of files"
            },
            "format": {
              "type": "string",
              "enum": ["file", "json", "text", "url", "custom"],
              "description": "Output format"
            }
          },
          "required": ["format"]
        }
      }
    },
    "consumes": {
      "type": "object",
      "description": "Artifacts or data entities expected by the application",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "object",
          "properties": {
            "description": { "type": "string" },
            "required": { "type": "boolean", "default": true },
            "format": {
              "type": "string",
              "enum": ["file", "json", "text", "url", "custom"],
              "description": "Input format"
            }
          },
          "required": ["format"]
        }
      }
    },
    "environment": {
      "type": "object",
      "patternProperties": {
        "^[A-Z0-9_]+$": {
          "type": "object",
          "properties": {
            "type": { "type": "string" },
            "description": { "type": "string" },
            "defval": {},
            "required": { "type": "boolean" },
            "hint": { "type": "string" },
            "options": {
              "type": ["object", "array"]
            }
          },
          "additionalProperties": true
        }
      }
    }
  },
  "required": ["name", "description", "executable", "environment"],
  "additionalProperties": true
}
